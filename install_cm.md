# Install Cloudera Manager 7.11.3 & CDP Runtime 7.1.9 (Full Guide)

This guide describes how to install **Cloudera Manager 7.11.3** and prepare it for managing your **CDP Runtime 7.1.9** cluster.

---

## 1) Configure Repository & Install CM Server/Agent

### 1.1 Download Cloudera Manager repo (via `wget`)

Download and configure the Cloudera Manager repository file.

```bash
wget https://(username):(password)@archive.cloudera.com/p/cm7/7.11.3.0/redhat7/yum/cloudera-manager.repo -O /etc/yum.repos.d/cloudera-manager.repo
```

Edit the repository file `/etc/yum.repos.d/cloudera-manager.repo` and replace `(username):(password)` with your **Cloudera archive credentials**.

```ini
[cloudera-manager]
name=Cloudera Manager 7.11.3.0
baseurl=https://archive.cloudera.com/p/cm7/7.11.3.0/redhat8/yum/
gpgkey=https://archive.cloudera.com/p/cm7/7.11.3.0/redhat8/yum/RPM-GPG-KEY-cloudera
username=(username)
password=(password)
gpgcheck=1
enabled=1
autorefresh=0
type=rpm-md

[postgresql10]
name=Postgresql 10
baseurl=https://archive.cloudera.com/postgresql10/redhat8/
gpgkey=https://archive.cloudera.com/postgresql10/redhat8/RPM-GPG-KEY-PGDG-10
enabled=1
gpgcheck=1
module_hotfixes=true
```

---

### 1.2 Install Cloudera Manager Server, Agent, and Daemons

```bash
sudo dnf install -y cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server
```

---

### 1.3 Setup Cloudera Manager Database (PostgreSQL)

Ensure PostgreSQL is installed and running.  
For full setup, refer to: [Install PostgreSQL 14.9](Install_PostgreSQL_14.9.md).

Configure CM database in `/etc/cloudera-scm-server/db.properties` if CM fails to start. set db with scm.
```bash
# /etc/cloudera-scm-server/db.properties
# Auto-generated by scm_prepare_database.sh
# General template for Cloudera Manager DB connection

# Database type: postgresql | mysql | oracle
com.cloudera.cmf.db.type=(db_type)

# Hostname or IP of the database server
com.cloudera.cmf.db.host=(db_host)

# Database name used by Cloudera Manager
com.cloudera.cmf.db.name=(db_name)

# Username & password for CM database
com.cloudera.cmf.db.user=(db_user)
com.cloudera.cmf.db.password=(db_password)

# Setup type (EXTERNAL if using custom DB, EMBEDDED if using built-in)
com.cloudera.cmf.db.setupType=EXTERNAL

#Example
#com.cloudera.cmf.db.type=postgresql
#com.cloudera.cmf.db.host=dbserver01
#com.cloudera.cmf.db.name=scm
#com.cloudera.cmf.db.user=scm
#com.cloudera.cmf.db.password=(password db)
#com.cloudera.cmf.db.setupType=EXTERNAL
#com.cloudera.cmf.orm.hibernate.connection.url=jdbc:postgresql://dbserver01:5432/scm

```
---

### 1.4. Start Cloudera Manager Services

```bash
systemctl start cloudera-scm-server
systemctl start cloudera-scm-agent
systemctl enable cloudera-scm-server
systemctl enable cloudera-scm-agent
```

Check services:
```bash
systemctl status cloudera-scm-server
systemctl status cloudera-scm-agent
```

Access the web UI on:
```
http://(hostname):7180
```

---

## 2) Cloudera Manager Web UI Wizard (Step-by-step)

### 2.1 Upload License
![Upload License](images/cm_license.png)
- Upload file lisensi atau pilih trial 60 hari.

### 2.2 Cluster Basics
![Cluster Basics](images/cm_cluster_basics.png)
- Isi **Cluster Name** (misal: `Cluster 1`).

### 2.3 Specify Hosts
![Specify Hosts](images/cm_hosts.png)
- Masukkan FQDN host (pastikan `hostname -f` konsisten).

### 2.4 Parcel Repository & Network Settings
![Parcel Repo](images/cm_parcels_repo.png)
- Pastikan URL repository **CDP Runtime 7.1.9** valid.
- Tambahkan Intel MKL (opsional): `https://parcels.repos.intel.com/mkl/latest`.

### 2.5 Select Repository
![Select Repo](images/cm_select_repo.png)
- Pilih **Cloudera Runtime 7.1.9** dan parcel tambahan bila perlu.

### 2.6 Install Parcels
![Install Parcels](images/cm_install_parcels.png)
- Jika agent error, jalankan: `systemctl restart cloudera-scm-agent`.

### 2.7 Inspect Cluster
![Inspect Cluster](images/cm_inspect_cluster.png)
- Jalankan **Network Inspector** & **Host Inspector**.

---

## 3) Add Services & Configure (Wizard Lanjutan)

### 3.0 Select Services 
![Select Services](images/cm_select_services.png)
Pilihan :
- Data Engineering, Data Mart, Operational Database, Custom Services.
- Pilih Custom
  
### 3.1 Select Custom Services
![Select Custom Services](images/cm_select_services_custom.png)
Contoh pilihan (custom):
- HDFS, Hive, Hive on Tez, Spark 3, YARN, YARN Queue Manager, Tez, ZooKeeper, Atlas.

### 3.2 Assign Roles
![Assign Roles](images/cm_assign_roles.png)
Contoh single-node:
- HDFS: NameNode, SecondaryNameNode, DataNode, Balancer → `(hostname)`
- Hive: Metastore, WebHCat, Gateway → `(hostname)`
- YARN: ResourceManager, NodeManager, JobHistory → `(hostname)`
- ZooKeeper Server → `(hostname)`

### 3.3 Setup Databases (Hive/YARN/Reports, dll.)
![Setup Databases](images/cm_setup_db.png)
Gunakan DB eksternal (PostgreSQL dari langkah sebelumnya):
- Hive → db:`hive`, user:`hive`, pass:`(password)`
- YARN → db:`yarn`, user:`yarn`, pass:`(password)`
- Reports Manager → db:`rman`, user:`rman`, pass:`(password)`  
Klik **Test Connection** sampai **Successful**.

### 3.4 Enter Required Parameters
![Required Params](images/cm_required_params.png)
- Biarkan default kecuali ada kebutuhan khusus.

### 3.5 Review Changes
![Review Changes](images/cm_review_changes.png)
- Default FS: `HDFS`
- Block size: `128 MB`

### 3.6 Command Details
![Command Details](images/cm_command_details.png)
- Wizard akan inisialisasi ZooKeeper, format HDFS, start Hive & YARN, dll.

### 3.7 Finish → Dashboard
![Dashboard](images/cm_dashboard.png)
- Pastikan semua service **green**.

---

## 4. Fix OS Release Compatibility (if CM Agent Fails)

Sometimes CM agent may not recognize the OS version.  
Backup and modify `/usr/lib/os-release` and `/etc/os-release` to trick detection.

### Backup first
```bash
cp /usr/lib/os-release /usr/lib/os-release.back
cp /etc/os-release /etc/os-release.back
```

### Inject RHEL 8.8 values
```bash
cat > /usr/lib/os-release <<EOF
NAME="Red Hat Enterprise Linux"
VERSION="8.8 (Ootpa)"
ID="rhel"
ID_LIKE="rhel fedora"
VERSION_ID="8.8"
PRETTY_NAME="Red Hat Enterprise Linux 8.8 (Ootpa)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:redhat:enterprise_linux:8.8:GA"
HOME_URL="https://www.redhat.com/"
BUG_REPORT_URL="https://bugzilla.redhat.com/"
REDHAT_BUGZILLA_PRODUCT="Red Hat Enterprise Linux 8"
REDHAT_BUGZILLA_PRODUCT_VERSION=8.8
REDHAT_SUPPORT_PRODUCT="Red Hat Enterprise Linux"
REDHAT_SUPPORT_PRODUCT_VERSION="8.8"
EOF

# Restart CM agent
systemctl restart cloudera-scm-agent
```

### Restore original files after CM installation/parcels are complete
```bash
mv /usr/lib/os-release.back /usr/lib/os-release
mv /etc/os-release.back /etc/os-release
systemctl restart cloudera-scm-agent
```

---

## 5) Verify Installation

- Ensure database is running.  
- Ensure CM agent and server are both active.  
- Access Cloudera Manager UI via port `7180`.

---

## 6) Hasil Akhir
- CM UI (`:7180`) up & running
- Parcels CDP 7.1.9 ter-install & activated
- Services (HDFS, Hive, YARN, ZooKeeper, dll.) berjalan

---
